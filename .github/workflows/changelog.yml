name: Auto Changelog

on:
  push:
    branches:
      - main

jobs:
  update-changelog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up git
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

      - name: Extract latest commits
        id: commits
        run: |
          # Az utols贸 changelog friss铆t茅s 贸ta t枚rt茅nt commitok
          LAST_TAG=$(git log --pretty=format:"%s" CHANGELOG.md | head -n1 || echo "none")
          echo "last tag: $LAST_TAG"
          git log --pretty=format:"- %s" HEAD~5..HEAD > commits.txt
          cat commits.txt
          echo "::set-output name=log::$(cat commits.txt)"

      - name: Update CHANGELOG
        id: changelog
        run: |
          FILE="CHANGELOG.md"
          if ! grep -q "\[Unreleased\]" $FILE; then
            echo -e "## [Unreleased]\n" | cat - $FILE > temp && mv temp $FILE
          fi
          sed -i "/## \[Unreleased\]/r commits.txt" $FILE

      - name: Commit updated changelog
        run: |
          git add CHANGELOG.md
          git diff-index --quiet HEAD || git commit -m " Auto-update Unreleased changelog"

      - name: Push changes
        run: git push || echo "No changes to push"

      - name: Notify if no updates
        if: steps.commits.outputs.log == ''
        run: echo " Tcs茅 m谩 ki! Nem volt commit a CHANGELOG-hoz az utols贸 friss铆t茅s 贸ta!"
