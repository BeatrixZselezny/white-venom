name: üêç White-Venom Ferrari Native Build

on:
  push:
    branches: [ "main", "master" ]

jobs:
  build:
    name: Native Debian Execution
    runs-on: [self-hosted, venom-builder]

    steps:
      - name: Checkout Source
        uses: actions/checkout@v4

      - name: Debug & Build
        run: |
          cd debian_skeleton
          echo "Build ind√≠t√°sa itt: $(pwd)"
          
          # Ellen≈ërizz√ºk a szersz√°mokat
          clang --version || echo "Clang hi√°nyzik!"
          llc --version || echo "LLC hi√°nyzik!"
          
          # Futtassuk a make-et, √©s ir√°ny√≠tsuk ki a hib√°t
          make clean
          make -j$(nproc) 2>&1 | tee build_error.log
          
          # Ha nem j√∂tt l√©tre a bin√°ris, dobjuk el a jobot, de tartsuk meg a logot
          if [ ! -f bin/venom_engine ]; then
            echo "--- FORD√çT√ÅSI HIBA NAPL√ì ---"
            cat build_error.log
            exit 1
          fi

      - name: BPF & Kernel Check
        if: success()
        run: |
          ls /sys/kernel/btf/vmlinux && echo "BTF is available!"
